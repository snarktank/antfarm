# Progress Log
Run: 047f8650-e1d3-4695-bf25-8390e26b061c
Task: Add easter egg ant command to antfarm CLI
Started: 2026-02-11 05:47 ET

## Codebase Patterns
- CLI entry: `src/cli/cli.ts`, commands matched via `group` variable from `process.argv[2]`
- Dynamic imports used for command modules (e.g., `await import("./ant.js")`)
- Build: `npm run build` runs `tsc -p tsconfig.json` + copies HTML + chmod
- Tests: `node --test dist/<file>.test.js` (node:test + node:assert/strict)
- ESM with NodeNext module resolution, `.js` extensions in imports

---

## 2026-02-11 05:47 - US-001: Add ant easter egg module with ASCII art and quotes
- Created `src/cli/ant.ts` with `printAnt()` function, 10 quotes, ASCII ant art
- Created `src/cli/ant.test.ts` with 4 tests (art output, quote output, 8+ unique quotes, no-throw)
- Wired `ant` command into `src/cli/cli.ts` via dynamic import
- Files changed: `src/cli/ant.ts` (new), `src/cli/ant.test.ts` (new), `src/cli/cli.ts` (modified)
- **Learnings:** CLI uses simple if-chain for command routing, not a framework
---

## 2026-02-11 05:52 - US-002: Wire ant command into CLI and add tests
- Created `tests/ant.test.ts` with 3 CLI integration tests (ASCII art, quote output, hidden from help)
- Tests use child_process.execFileSync to run the actual CLI binary
- All acceptance criteria verified: CLI works, hidden from help, tests pass, build passes
- Files changed: `tests/ant.test.ts` (new)
- **Learnings:** Node 22 runs .ts files directly with type stripping; tests in `tests/` use this approach
---

## 2026-02-12 17:10 - story-1: Create version injection build script
- Created `scripts/inject-version.js` — reads version from package.json, replaces {{VERSION}} in landing/index.html
- Script is idempotent: handles both placeholder and previously injected versions
- Added `v{{VERSION}}` badge markup to landing/index.html (class="version-badge")
- Created `scripts/__tests__/inject-version.test.js` with 3 tests (placeholder replacement, idempotency, correct semver)
- All 3 tests pass, build passes, typecheck passes
- 2 pre-existing landing test failures unrelated to this story (missing id="features", id="quickstart", .feature-grid)
- **Learnings:** Landing page uses plain HTML, no build pipeline yet for HTML transforms

## 2026-02-12 17:15 - story-2: Add version badge to landing page HTML and CSS, wire into build
- Added .version-badge styles to landing/style.css (pill badge, accent green bg, mono font)
- Updated package.json build script to run `node scripts/inject-version.js` after tsc
- Added version badge test to landing/__tests__/landing.test.js (checks element exists + valid semver)
- Build successfully injects version 0.2.3 into landing page
- Version badge test passes; 2 pre-existing test failures unchanged (missing id="features", .feature-grid)
- Files changed: landing/style.css, package.json, landing/__tests__/landing.test.js

## 2026-02-12 17:42 - S1: Add agent-browser skill to verifier and reviewer agents in workflow.yml
- Added `skills: ['agent-browser']` to verifier and reviewer agents in workflows/feature-dev/workflow.yml
- Skills field goes under workspace config, validated by workflow-spec.ts as array
- Created tests/workflow-skills.test.ts with 3 tests (verifier has skill, reviewer has skill, planner has no skill)
- All tests pass, build passes, typecheck passes
- Files changed: workflows/feature-dev/workflow.yml, tests/workflow-skills.test.ts (new)
- **Learnings:** Skills in workflow.yml go under agent.workspace.skills as string array; validated in validateAgents()

## 2026-02-12 17:52 - S2: Add frontend file detection utility
- Created src/lib/frontend-detect.ts with isFrontendChange(files: string[]): boolean
- Checks extensions (.html, .css, .scss, .less, .jsx, .tsx, .vue, .svelte)
- Checks frontend dirs (public/, static/, assets/, components/, pages/, views/, styles/)
- Excludes test files (.test., .spec., __tests__/)
- Created tests/frontend-detect.test.ts with 10 tests covering all acceptance criteria
- All tests pass, build passes, typecheck passes
- **Learnings:** Node 22 runs .ts imports directly in tests; utility pattern: Set for extensions, array.some for dir matching

## 2026-02-12 17:57 - S3: Add diff-based context variable to step resolution
- Added computeHasFrontendChanges() to step-ops.ts using execSync git diff + isFrontendChange
- claimStep now populates context['has_frontend_changes'] with 'true'/'false' when repo+branch in context
- Defaults to 'false' when repo/branch missing or git command fails
- Created tests/frontend-context.test.ts with 7 tests (frontend files, backend-only, invalid repo, missing branch, CSS in dirs, test file exclusion, default)
- All tests pass, build passes, typecheck passes
- Files changed: src/installer/step-ops.ts (modified), tests/frontend-context.test.ts (new)
- **Learnings:** step-ops.ts imports chain through DB so tests must import from dist/; computeHasFrontendChanges exported for testability

## 2026-02-12 18:05 - S4: Update verify step prompt with conditional browser verification
- Added conditional "Visual Verification" section to verify step input in workflow.yml
- Section references {{has_frontend_changes}} and instructs agent to use agent-browser skill
- Defines visual PASS criteria (correct layout, styling, visibility) and FAIL criteria (broken layout, missing/overlapping elements)
- When has_frontend_changes is 'false', instructs to skip visual verification entirely
- Created tests/verify-prompt-frontend.test.ts with 7 tests covering all acceptance criteria
- All tests pass, build passes, typecheck passes
- Files changed: workflows/feature-dev/workflow.yml (modified), tests/verify-prompt-frontend.test.ts (new)

## 2026-02-12 18:10 - S5: Update review step prompt with conditional browser verification
- Added "Visual Review (Frontend Changes)" section to review step input in workflow.yml
- Section references {{has_frontend_changes}} and instructs agent to use agent-browser skill
- Focuses on design quality and polish (distinct from verify step's structural checks)
- Evaluates: polish, color/typography consistency, layout balance, interactive element appearance, cohesion
- When has_frontend_changes is 'false', instructs to skip visual review entirely
- Created tests/review-prompt-frontend.test.ts with 7 tests covering all acceptance criteria
- All tests pass, build passes, typecheck passes
- Files changed: workflows/feature-dev/workflow.yml (modified), tests/review-prompt-frontend.test.ts (new)

## 2026-02-12 18:27 - S6: Update shared verifier AGENTS.md with browser verification guidance
- Added "Visual/Browser-Based Verification (Conditional)" section to agents/shared/verifier/AGENTS.md
- Section covers: when to verify (conditional on step prompt), how to use agent-browser (navigate, snapshot, screenshot), what to look for (layout, styling, visibility, spacing, responsiveness), and pass/fail criteria
- Created tests/verifier-agents-md.test.ts with 5 tests covering all acceptance criteria
- All tests pass, build passes, typecheck passes
- Files changed: agents/shared/verifier/AGENTS.md (modified), tests/verifier-agents-md.test.ts (new)

## 2026-02-12 19:29 - S7: Update reviewer AGENTS.md with browser verification guidance
- Added "Visual/Browser-Based Verification (Conditional)" section to reviewer AGENTS.md
- Section explains agent-browser usage: navigate, screenshot, snapshot commands
- Focus on design quality checks: visual hierarchy, consistency, alignment, whitespace, typography, color/contrast, responsiveness, interaction states
- Section is conditional — only activates when step prompt requests it
- Created tests/reviewer-agents-md.test.ts with 5 tests covering all acceptance criteria
- All tests pass, build passes, typecheck passes
- Files changed: workflows/feature-dev/agents/reviewer/AGENTS.md, tests/reviewer-agents-md.test.ts (new)
- **Learnings:** Reviewer visual checks emphasize design polish vs verifier's functional correctness focus

## 2026-02-12 20:35 - S8: Install agent-browser skill during workflow install for verifier/reviewer
- Added resolveExternalSkillSource() to check ~/.openclaw/workspace/skills/<name> and ~/.openclaw/skills/<name>
- Added installExternalSkills() that installs non-bundled skills from user directories into agent workspaces
- Bundled skills (antfarm-workflows) still handled separately by installWorkflowSkill()
- Missing external skills produce a warning but don't fail installation
- Created tests/external-skills.test.ts with 5 tests (primary path, fallback path, missing skill, bundled coexistence, multi-agent)
- All tests pass, build passes, typecheck passes
- Files changed: src/installer/agent-provision.ts (modified), tests/external-skills.test.ts (new)
- **Learnings:** provisionAgents is the entry point for all agent setup; skill installation runs after file provisioning
